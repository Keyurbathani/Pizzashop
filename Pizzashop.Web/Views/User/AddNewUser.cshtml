@{
    ViewData["title"] = "AddNewUser";
    Layout = "_DashboardLayout";
}

@model Pizzashop.Entity.ViewModels.AddNewUserModel

<div class="container">

    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">
        <h1 class="h2">Add New User</h1>
        <div class="d-flex mb-2 mb-md-0">
            <a class="text-white btn login-btn" href="/user/index">Back</a></button>
        </div>
    </div>

    <form asp-action="CreateUser" asp-controller="User" enctype="multipart/form-data">

        @* <input type="text" asp-for="Id" hidden> *@
        
        <div class="row">
            <!-- First Name -->
            <div class="col-md-6 mt-2">
                <div class="form-floating">
                    <input type="text" asp-for="FisrtName" class="form-control" id="FirstName" placeholder="First name">
                    <label for="FirstName">First name</label>
                </div>
                <span asp-validation-for="FisrtName" class="text-danger"></span>
            </div>

            <!-- Last Name -->
            <div class="col-md-6 mt-2">
                <div class="form-floating">
                    <input type="text" asp-for="LastName" class="form-control" id="LastName" placeholder="Last name">
                    <label for="LastName">Last Name</label>
                </div>
                <span asp-validation-for="LastName" class="text-danger"></span>
            </div>

            <!-- Username -->
            <div class="col-md-6 mt-2">
                <div class="form-floating">
                    <input type="text" asp-for="Username" class="form-control" id="Username" placeholder="Username">
                    <label for="Username">Username</label>
                </div>
                <span asp-validation-for="Username" class="text-danger"></span>
            </div>

            <!-- Role -->
            <div class="col-md-6 mt-2">
                <div class="form-floating">
                    <select id="RoleId" asp-for="RoleId" name="RoleId" class="form-select" asp-items="ViewBag.Roles">
                        <option selected disabled> select role </option>
                    </select>
                    <label for="RoleId">Role</label>
                </div>
                <span asp-validation-for="RoleId" class="text-danger"></span>
            </div>

            <!-- Email -->
            <div class="col-md-6 mt-2">
                <div class="form-floating">
                    <input type="email" asp-for="Email" class="form-control" id="Email" placeholder="Email">
                    <label for="Email">Email</label>
                </div>
                <span asp-validation-for="Email" class="text-danger"></span>
            </div>

            <!-- Password -->
            
                <div class="col-md-6 mt-2">
                    <div class="input-group form-floating">
                        <input type="password" asp-for="Password" class="form-control" id="floatingPassword"
                            placeholder="Password*">
                        <span class="input-group-text" id="inputGroupPrepend" onclick="eyeShow()"><i id="eye-icon"
                                class="fa-regular fa-eye-slash"></i></span>
                        <label class="py-2">Password</label>
                    </div>
                     <span asp-validation-for="Password" class="text-danger"></span>
                </div>
               
           

            <!-- Upload Image -->
            <div class="col-md-12 mt-2">
                <label for="fileInput" class="custom-file-upload bg-white">
                    <i class="fa fa-cloud-upload"></i> <span class="browse">Browse files</span>
                 <img class="user-img d-none rounded-circle" alt="" id="displayImage" style="width: 100px; height: 100px;">
                </label>
                <input asp-for="ProfileImage" type="file" id="fileInput" class="d-none bg-white" accept="image/*" />
                <input type="hidden" asp-for="Imageurl" />
                <p id="file-name">No file chosen</p>
                 <span asp-validation-for="ProfileImage" class="text-danger"></span>
            </div>

            <!-- Country -->
            <div class="col-md-4 mt-2">
                <div class="form-floating">
                    <select id="CountryId" asp-for="CountryId" name="CountryId" class="form-select" asp-items="ViewBag.Countries">
                        <option selected disabled> select Country </option>
                    </select>
                    <label for="CountryId">Country</label>
                </div>
                <span asp-validation-for="CountryId" class="text-danger"></span>
            </div>

            <!-- State -->
            <div class="col-md-4 mt-2">
                <div class="form-floating">
                    <select id="StateId" asp-for="StateId" name="StateId" class="form-select" asp-items="ViewBag.States">
                        <option selected disabled> select state </option>
                    </select>
                    <label for="StateId">State</label>
                </div>
                <span asp-validation-for="StateId" class="text-danger"></span>
            </div>

            <!-- City -->
            <div class="col-md-4 mt-2">
                <div class="form-floating">
                    <select id="CityId" asp-for="CityId" name="CityId" class="form-select" asp-items="ViewBag.Cities">
                        <option selected disabled> select city </option>
                    </select>
                    <label for="CityId">City</label>
                </div>
                <span asp-validation-for="CityId" class="text-danger"></span>
            </div>

            <!-- Zip Code -->
            <div class="col-md-4 mt-2">
                <div class="form-floating">
                    <input type="number" asp-for="Zipcode" class="form-control" id="Zipcode" placeholder="Zip code">
                    <label for="Zipcode">Zip Code</label>
                </div>
                <span asp-validation-for="Zipcode" class="text-danger"></span>
            </div>

            <!-- Address -->
            <div class="col-md-4 mt-2">
                <div class="form-floating">
                    <input type="text" asp-for="Address" class="form-control" id="Address" placeholder="Address">
                    <label for="Address">Address</label>
                </div>
                <span asp-validation-for="Address" class="text-danger"></span>
            </div>

            <!-- Phone -->
            <div class="col-md-4 mt-2">
                <div class="form-floating">
                    <input asp-for="Phone" type="text" class="form-control" id="Phone" placeholder="Phone">
                    <label for="Phone">Phone</label>
                </div>
                <span asp-validation-for="Phone" class="text-danger"></span>
            </div>

            <!-- Submit and Cancel buttons -->
            <div class="mt-3 modal-footer">
                <button type="submit" class="btn login-btn me-2">Create User</button>
                <a class="btn btn-secondary me-3" href="/user/index">Cancel</a>
            </div>
        </div>
    </form>



</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    $(document).ready(function () {


        $('#fileInput').change(function (event) {
                var input = event.target;
                var reader = new FileReader();
                 let fileName = $(this).val().split("\\").pop();
                 let file = event.target.files[0];

                reader.onload = function (e) {
                    var image = new Image();
                    image.src = e.target.result;
                    
                    image.onload = function(){

                        $("#file-name").text(fileName);
                        $('#displayImage').attr('src', reader.result);
                        $(".user-img").removeClass("d-none");
                        $(".fa-cloud-upload").addClass("d-none")
                        $(".browse").addClass("d-none") 

                    }

                    image.onerror = function(){
                        @* $("#ImageValidation").html("Invalid image file.") *@
                        toastr.error("Invalid image file. Please select a valid image.");                  
                        $("#file-name").text("No file chosen");
                        $("#fileInput").val('');
                    }
                    
                    
                };

                if (input.files && input.files[0]) {
                    reader.readAsDataURL(input.files[0]);
                    
                }
            });

       

        $('#CountryId').change(function () {
            var countryId = $(this).val();
            $.getJSON('@Url.Action("GetStates", "Dashboard")', { countryId: countryId }, function (data) {
                var stateSelect = $('#StateId');
                stateSelect.empty().append('<option selected disabled hidden>Select State</option>');
                $.each(data, function (index, state) {

                    stateSelect.append($('<option>', {
                        value: state.id,
                        text: state.name
                    }));
                });
                @* stateSelect.val(data[0]?.id).change(); *@
            });
        });

        $('#StateId').change(function () {
            var stateId = $(this).val();
            $.getJSON('@Url.Action("GetCities", "Dashboard")', { stateId: stateId }, function (data) {
                var citySelect = $('#CityId');
                citySelect.empty().append('<option selected disabled hidden>Select City</option>');
                $.each(data, function (index, city) {
                    citySelect.append($('<option>', {
                        value: city.id,
                        text: city.name
                    }));
                });
                @* citySelect.val(data[0]?.id); *@
            });
        });


    });
    
</script>
